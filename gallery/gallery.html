<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Gallery</title>
	<!-- <meta name="viewport" content="width=devive-width,initial-scale=1.0"> -->
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<link rel="stylesheet" text="text/css" href="animate.css">
	<script src="zepto.min.js"></script>
	<script src="touch.js"></script>
</head>
<style type="text/css">
	*{
		margin: 0;
		padding: 0;
	}
	body {
		background: #000;
	}
	ul{
		list-style: none;
	}
	li {
		float: left;
		width: 100px;
		height: 100px;
		overflow: hidden;
	}

	.large {
		width: 100%;
		height: 100%;
		position: absolute;
		top: 0;
		left: 0;
		background: #000;
	}

</style>
<body>
	<ul id="container" class="img-container">
		<li><img src="images/1.jpg" alt=""></li>
		<li><img src="images/2.jpg" alt=""></li>
		<li><img src="images/3.jpg" alt=""></li>
		<li><img src="images/4.jpg" alt=""></li>
		<li><img src="images/5.jpg" alt=""></li>
		<li><img src="images/6.jpg" alt=""></li>
	</ul>

	<div class="large animated fadeIn" id="large_container" style="display: none;">
		<img id="large_img"></img>
	</div>

	<script>
		var total = 17;
		var zWin = $(window);
		var render = function(){
			var padding = 2;
			var winWidth = zWin.width();
			var picWidth = Math.floor((winWidth-padding*3)/4);
			var tmpl = '';//存储html
			for(var i=1;i<total;i++){
				var p = padding;
				var imgSrc = 'images/'+i+'.jpg';
				if(i%4 == 1){
					p = 0;
				}
				tmpl += '<li data-id="'+ i +'" class="animated bounceIn" style="width:'+ picWidth +'px;height:'+ picWidth +'px;padding-top:'+ padding +';padding-left:'+ p +'px;"><canvas id="cvs_'+i+'"></canvas>';
				var imageObj = new Image();
				imageObj.index = i ;
				imageObj.onload = function(){
					var cvs = $("#cvs_"+this.index)[0].getContext("2d");
					cvs.width = this.width;
					cvs.height = this.height;
					cvs.drawImage(this,0,0);
				}
				imageObj.src = imgSrc;
			}

			$("#container").html(tmpl);
		}

		render();

		var wImage = $("#large_img");
		var domImage = wImage[0];

		var loadImg = function(id,callback){
			$("#large_container").css({
				width:zWin.width(),
				hegiht:zWin.height()
			}).show();

			var imgsrc = 'images/'+ id +'.large.jpg';
			var imageObj = new Image();
			imageObj.onload = function(){

				var w = this.width;
				var h = this.height;
				var winWidth = zWin.width();
				var winHeight = zWin.height();

				var realw = winHeight*w/h;
				var paddingleft = parseInt((winWidth - realw)/2);
				var realh = winWidth*h/w;
				var paddingTop = parseInt((winHeight - realh)/2);
				wImage.css("width","auto").css("height","auto").css("padding-top",0).css("padding-left",0);

				if(h/w>1.2){//竖图
					wImage.attr("src",imgsrc).css("height",winHeight).css("padding-left",paddingleft);
				}else{//横图
					wImage.attr("src",imgsrc).css("width",winWidth).css("padding-top",paddingTop);
				}

				callback&&callback();

				//动画效果
				
			}
			imageObj.src = imgsrc;
		}

		var cid;

		$("#container").delegate("li","tap",function(){
			var _id = cid = $(this).attr("data-id");
			loadImg(_id);
		});

		$("#large_container").tap(function(){
			$(this).hide();
		}).swipeLeft(function(){
			cid ++;
			if(cid > total){
				cid = total;
			}else {
				loadImg(cid,function(){
					domImage.addEventListener('webkitAnimationEnd',function(){
						wImage.removeClass('animated bounceInRight');
						domImage.removeEventListener('webkitAnimationEnd',false);
					},false);
					wImage.addClass('animated bounceInRight');
				});
			}
		}).swipeRight(function(){
			cid --;
			if(cid <1){
				cid = 1;
			}else{
				loadImg(cid,function(){
					domImage.addEventListener('webkitAnimationEnd',function(){
						wImage.removeClass('animated bounceInLeft');
						domImage.removeEventListener('webkitAnimationEnd',false);
					},false);
					wImage.addClass('animated bounceInLeft');
				});
			}
		});




	</script>


</body>
</html>